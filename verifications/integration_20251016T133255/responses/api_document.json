{"content":"# Sim-Eval HTTP API\n\n> Curated from `instruction_documents/Describing_Simulation_0_api_map.md` and\n> `instruction_documents/Describing_Simulation_0_codifying_simulations.md` (Section IX).\n\nThe Sim-Eval server exposes a REST surface that lets an operator discover the\nsimulation, manage runtime assets, stream telemetry, and track service health.\nAll endpoints accept and emit JSON unless otherwise noted. Successful control\noperations return an acknowledgement payload with the following structure:\n\n```json\n{\n  \"acknowledgement\": {\n    \"messageId\": \"msg-42\",\n    \"status\": \"success\",\n    \"detail\": \"operation description\"\n  }\n}\n```\n\nWhen acknowledgements report `\"status\": \"error\"` the HTTP status will be `500`\nand a `detail` field explains the failure.\n\n## Endpoint Inventory\n\n| # | Method | Path | Purpose |\n| - | ------ | ---- | ------- |\n| 1 | GET | `/` | Root discovery payload with navigation cues. |\n| 2 | GET | `/information/Describing_Simulation.md` | Exposes the descriptive spec served by this file’s companion document. |\n| 3 | GET | `/information/api.md` | Returns this API guide. |\n| 4 | POST | `/simulation/start` | Start the simulation loop. |\n| 5 | POST | `/simulation/pause` | Pause the simulation loop, retaining state. |\n| 6 | POST | `/simulation/stop` | Stop and reset the simulation loop. |\n| 7 | POST | `/simulation/system` | Inject a simulation system definition at runtime. |\n| 8 | DELETE | `/simulation/system/:id` | Eject a simulation system by identifier. |\n| 9 | POST | `/simulation/component` | Register a simulation component definition. |\n| 10 | DELETE | `/simulation/component/:id` | Remove a simulation component definition. |\n| 11 | GET | `/simulation/stream` | Server-Sent Events (SSE) stream of simulation frames. |\n| 12 | POST | `/evaluation/frame` | Inject an evaluation frame for analysis. |\n| 13 | POST | `/evaluation/system` | Inject an evaluation system definition. |\n| 14 | DELETE | `/evaluation/system/:id` | Eject an evaluation system definition. |\n| 15 | POST | `/evaluation/component` | Register an evaluation component definition. |\n| 16 | DELETE | `/evaluation/component/:id` | Remove an evaluation component definition. |\n| 17 | GET | `/evaluation/stream` | SSE stream of evaluation frames. |\n| 18 | GET | `/codebase/tree` | Recursive snapshot of the repository directory tree. |\n| 19 | GET | `/codebase/file?path=<relative>` | Retrieve file contents relative to the repository root. |\n| 20 | POST | `/codebase/plugin` | Upload plugin source into the runtime plugin directory. |\n| 21 | GET | `/health` | Lightweight service health probe. |\n| 22 | GET | `/status` | Detailed simulation/evaluation runtime status. |\n\n## Endpoint Details\n\n### 1. GET `/` — Discoverability Root\n\nReturns a JSON document listing key routes, including informational markdown,\nsimulation and evaluation controls, codebase utilities, and health endpoints.\nConsumers should read this response first to explore the surface area.\n\n### 2–3. GET `/information/...`\n\n- `/information/Describing_Simulation.md` delivers the descriptive theory of the\n  sim-eval environment. Content is sourced from the instruction corpus and\n  updated alongside code changes.\n- `/information/api.md` returns this API reference. Both informational endpoints\n  respond with JSON payloads shaped as `{ \"content\": \"<markdown>\" }`.\n\n### 4–11. Simulation Control & Telemetry\n\nThe simulation routes publish inbound messages onto the simulation player:\n\n- **POST `/simulation/start`**, **`/pause`**, **`/stop`** send\n  `simulation.start`, `simulation.pause`, and `simulation.stop` messages,\n  coordinating the lifecycle of the simulation loop.\n- **POST `/simulation/system`** and **DELETE `/simulation/system/:id`** manage\n  runtime systems. Payloads should include the serialized system definition and,\n  for deletions, the `:id` path parameter to identify which system to eject.\n- **POST `/simulation/component`** and **DELETE `/simulation/component/:id`**\n  register and revoke component definitions. Component payloads typically carry\n  a `type` string and an arbitrary `schema` or `defaults` object.\n- **GET `/simulation/stream`** upgrades the connection to Server-Sent Events,\n  emitting `event: simulation` entries whenever the simulation produces a frame.\n  Each message places the serialized frame at the `data:` line. Keep-alive\n  comments are emitted every 15 seconds to sustain intermediaries.\n\nAll mutation endpoints resolve to acknowledgement payloads. The stream uses the\n`text/event-stream` content type and must be consumed with SSE-aware clients.\n\n### 12–17. Evaluation Control & Telemetry\n\nEvaluation routes mirror simulation semantics while targeting the evaluation\nplayer buses:\n\n- **POST `/evaluation/frame`** accepts a JSON frame payload. The evaluation\n  player ingests the frame and replays it as outbound frames which surface via\n  the SSE stream or downstream analytics.\n- System/component injection and ejection follow the same patterns as the\n  simulation endpoints, including the acknowledgement envelope.\n- **GET `/evaluation/stream`** produces `event: evaluation` SSE entries,\n  allowing clients to observe evaluation results with low latency.\n\n### 18–20. Codebase Utilities\n\n- **GET `/codebase/tree`** returns `{ \"entries\": [...] }`, where entries form a\n  recursive tree of `{ name, type, children? }`. This view is used to discover\n  project assets before retrieving or uploading files.\n- **GET `/codebase/file?path=<relative>`** validates the supplied relative path\n  against the repository root before returning `{ \"path\": \"...\", \"content\": \"...\"\n  }`. Requesting paths outside the repository or for missing files yields `400`\n  or `404` responses.\n- **POST `/codebase/plugin`** writes plugin sources under the runtime plugin\n  directory. Payloads require `path` (relative to `plugins/`) and `content`\n  fields. Intermediate directories are created automatically. On success the\n  route responds with `201` and echoes the accepted `path`.\n\n### 21–22. System Health\n\n- **GET `/health`** supplies a quick probe containing service metadata, route\n  registrations, and a timestamp. It is intended for orchestration health checks\n  and readiness gates.\n- **GET `/status`** returns the runtime status of both simulation and evaluation\n  players, including boolean `running` flags and the most recent tick counters.\n  Operators should verify player state before and after lifecycle operations to\n  ensure commands took effect.\n\n## Error Handling\n\n- `404` indicates that the requested route is not registered or a codebase file\n  was not found.\n- `400` denotes malformed input (missing query parameters, invalid plugin path).\n- `500` accompanies failed acknowledgements or filesystem errors. The response\n  payload always includes an `error` message or acknowledgement `detail`.\n\n## Streaming Considerations\n\n- SSE endpoints remain open until the client disconnects. Always close the\n  connection explicitly in automation to avoid resource leaks.\n- Keep-alive comments ensure compatibility with proxies that time out idle HTTP\n  connections. Clients should ignore comment lines beginning with `:`.\n- Each frame message contains the serialized frame object produced by the\n  corresponding player. Consumers may parse JSON from the `data:` segment.\n\n## Authentication & Headers\n\nThe reference implementation does not enforce authentication. Operators are\nexpected to run the service within a controlled environment. All JSON requests\nshould supply `Content-Type: application/json`; responses inherit that header\nautomatically for structured payloads.\n\n## Related Documentation\n\n- Descriptive theory: `/information/Describing_Simulation.md`\n- Integration workflow: `tools/run_integration.sh`\n- Instruction sources: `instruction_documents/Describing_Simulation_0_api_map.md`,\n  `instruction_documents/Describing_Simulation_0_codifying_simulations.md`\n"}